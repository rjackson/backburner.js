{"version":3,"file":"backburner.js","sources":["../lib/backburner/utils.ts","../lib/backburner/binary-search.ts","../lib/backburner/queue.ts","../lib/backburner/deferred-action-queues.ts","../lib/backburner/iterator-drain.ts","../lib/index.ts"],"sourcesContent":["const NUMBER = /\\d+/;\n\nexport const now = Date.now;\n\nexport function each<T>(collection: T[], callback: (v: T) => void) {\n  for (let i = 0; i < collection.length; i++) {\n    callback(collection[i]);\n  }\n}\n\nexport function isString(suspect: any): suspect is string {\n  return typeof suspect === 'string';\n}\n\nexport function isFunction(suspect: any): suspect is Function {\n  return typeof suspect === 'function';\n}\n\nexport function isNumber(suspect: any): suspect is number {\n  return typeof suspect === 'number';\n}\n\nexport function isCoercableNumber(suspect) {\n  return isNumber(suspect) || NUMBER.test(suspect);\n}\n\nexport function noSuchQueue(name) {\n  throw new Error(`You attempted to schedule an action in a queue (${name}) that doesn\\'t exist`);\n}\n\nexport function noSuchMethod(name) {\n  throw new Error(`You attempted to schedule an action in a queue (${name}) for a method that doesn\\'t exist`);\n}\n\nexport function getOnError(options) {\n  return options.onError || (options.onErrorTarget && options.onErrorTarget[options.onErrorMethod]);\n}\n\nexport function findDebouncee(target, method, debouncees) {\n  return findItem(target, method, debouncees);\n}\n\nexport function findThrottler(target, method, throttlers) {\n  return findItem(target, method, throttlers);\n}\n\nexport function findItem(target, method, collection) {\n  let item;\n  let index = -1;\n\n  for (let i = 0, l = collection.length; i < l; i++) {\n    item = collection[i];\n    if (item[0] === target && item[1] === method) {\n      index = i;\n      break;\n    }\n  }\n\n  return index;\n}\n","export default function binarySearch(time, timers) {\n  let start = 0;\n  let end = timers.length - 2;\n  let middle;\n  let l;\n\n  while (start < end) {\n    // since timers is an array of pairs 'l' will always\n    // be an integer\n    l = (end - start) / 2;\n\n    // compensate for the index in case even number\n    // of pairs inside timers\n    middle = start + l - (l % 2);\n\n    if (time >= timers[middle]) {\n      start = middle + 2;\n    } else {\n      end = middle;\n    }\n  }\n\n  return (time >= timers[start]) ? start + 2 : start;\n}\n","import {\n  isString\n} from './utils';\nexport const enum QUEUE_STATE {\n  Pause = 1\n}\nexport default class Queue {\n  public _queue: any[] = []; // TODO: should be private\n\n  private name: string;\n  private globalOptions: any;\n  private options: any;\n  private _queueBeingFlushed: any[] = [];\n  private targetQueues = {};\n  private index = 0;\n\n  constructor(name: string, options: any, globalOptions: any) {\n    this.name = name;\n    this.globalOptions = globalOptions || {};\n    this.options = options;\n  }\n\n  public push(target, method, args, stack) {\n    let queue = this._queue;\n    queue.push(target, method, args, stack);\n\n    return {\n      queue: this,\n      target,\n      method\n    };\n  }\n\n  public pushUnique(target, method, args, stack) {\n    let guid = this.guidForTarget(target);\n\n    if (guid) {\n      return this.pushUniqueWithGuid(guid, target, method, args, stack);\n    }\n\n    this.pushUniqueWithoutGuid(target, method, args, stack);\n\n    return {\n      queue: this,\n      target,\n      method\n    };\n  }\n\n  public flush(sync?) {\n    let globalOptions = this.globalOptions;\n    let options = this.options;\n    let before = options && options.before;\n    let after = options && options.after;\n    let onError = globalOptions.onError || (globalOptions.onErrorTarget &&\n                                            globalOptions.onErrorTarget[globalOptions.onErrorMethod]);\n    let target;\n    let method;\n    let args;\n    let errorRecordedForStack;\n    let invoke = onError ? this.invokeWithOnError : this.invoke;\n\n    this.targetQueues = Object.create(null);\n    let queue = this._queue;\n    let queueItems;\n    if (this._queueBeingFlushed && this._queueBeingFlushed.length > 0) {\n      queueItems = this._queueBeingFlushed;\n    } else {\n      queueItems = this._queueBeingFlushed = this._queue;\n      this._queue = [];\n    }\n\n    if (before) {\n      before();\n    }\n\n    for (let i = this.index; i < queueItems.length; i += 4) {\n      this.index += 4;\n\n      target                = queueItems[i];\n      method                = queueItems[i + 1];\n      args                  = queueItems[i + 2];\n      errorRecordedForStack = queueItems[i + 3]; // Debugging assistance\n\n      if (isString(method)) {\n        method = target[method];\n      }\n\n      // method could have been nullified / canceled during flush\n      if (method) {\n        //\n        //    ** Attention intrepid developer **\n        //\n        //    To find out the stack of this task when it was scheduled onto\n        //    the run loop, add the following to your app.js:\n        //\n        //    Ember.run.backburner.DEBUG = true; // NOTE: This slows your app, don't leave it on in production.\n        //\n        //    Once that is in place, when you are at a breakpoint and navigate\n        //    here in the stack explorer, you can look at `errorRecordedForStack.stack`,\n        //    which will be the captured stack when this job was scheduled.\n        //\n        //    One possible long-term solution is the following Chrome issue:\n        //       https://bugs.chromium.org/p/chromium/issues/detail?id=332624\n        //\n        invoke(target, method, args, onError, errorRecordedForStack);\n      }\n\n      if (this.index !== this._queueBeingFlushed.length &&\n        this.globalOptions.mustYield && this.globalOptions.mustYield()) {\n        return QUEUE_STATE.Pause;\n      }\n    }\n\n    if (after) {\n      after();\n    }\n\n    this._queueBeingFlushed.length = 0;\n    this.index = 0;\n    if (sync !== false &&\n        this._queue.length > 0) {\n      // check if new items have been added\n      this.flush(true);\n    }\n  }\n\n  public hasWork() {\n    return this._queueBeingFlushed.length > 0 || this._queue.length > 0;\n  }\n\n  public cancel(actionToCancel) {\n    let queue = this._queue;\n    let currentTarget;\n    let currentMethod;\n    let i;\n    let l;\n    let { target, method }  = actionToCancel;\n\n    if (this.targetQueues && target) {\n      let guid = this.guidForTarget(target);\n      let targetQueue = this.targetQueues[guid];\n\n      if (targetQueue) {\n        for (i = 0, l = targetQueue.length; i < l; i++) {\n          if (targetQueue[i] === method) {\n            targetQueue.splice(i, 1);\n          }\n        }\n      }\n    }\n\n    for (i = 0, l = queue.length; i < l; i += 4) {\n      currentTarget = queue[i];\n      currentMethod = queue[i + 1];\n\n      if (currentTarget === target &&\n          currentMethod === method) {\n        queue.splice(i, 4);\n        return true;\n      }\n    }\n\n    // if not found in current queue\n    // could be in the queue that is being flushed\n    queue = this._queueBeingFlushed;\n\n    if (!queue) {\n      return;\n    }\n\n    for (i = 0, l = queue.length; i < l; i += 4) {\n      currentTarget = queue[i];\n      currentMethod = queue[i + 1];\n\n      if (currentTarget === target &&\n          currentMethod === method) {\n        // don't mess with array during flush\n        // just nullify the method\n        queue[i + 1] = null;\n        return true;\n      }\n    }\n  }\n\n  private guidForTarget(target) {\n    if (!target) { return; }\n\n    let peekGuid = this.globalOptions.peekGuid;\n    if (peekGuid) {\n      return peekGuid(target);\n    }\n\n    let KEY = this.globalOptions.GUID_KEY;\n    if (KEY) {\n      return target[KEY];\n    }\n  }\n\n  private pushUniqueWithoutGuid(target, method, args, stack) {\n    let queue = this._queue;\n\n    for (let i = 0, l = queue.length; i < l; i += 4) {\n      let currentTarget = queue[i];\n      let currentMethod = queue[i + 1];\n\n      if (currentTarget === target && currentMethod === method) {\n        queue[i + 2] = args;  // replace args\n        queue[i + 3] = stack; // replace stack\n        return;\n      }\n    }\n\n    queue.push(target, method, args, stack);\n  }\n\n  private targetQueue(targetQueue, target, method, args, stack) {\n    let queue = this._queue;\n\n    for (let i = 0, l = targetQueue.length; i < l; i += 2) {\n      let currentMethod = targetQueue[i];\n      let currentIndex  = targetQueue[i + 1];\n\n      if (currentMethod === method) {\n        queue[currentIndex + 2] = args;  // replace args\n        queue[currentIndex + 3] = stack; // replace stack\n        return;\n      }\n    }\n\n    targetQueue.push(\n      method,\n      queue.push(target, method, args, stack) - 4\n    );\n  }\n\n  private pushUniqueWithGuid(guid, target, method, args, stack) {\n    let hasLocalQueue = this.targetQueues[guid];\n\n    if (hasLocalQueue) {\n      this.targetQueue(hasLocalQueue, target, method, args, stack);\n    } else {\n      this.targetQueues[guid] = [\n        method,\n        this._queue.push(target, method, args, stack) - 4\n      ];\n    }\n\n    return {\n      queue: this,\n      target: target,\n      method: method\n    };\n  }\n\n  private invoke(target, method, args /*, onError, errorRecordedForStack */) {\n    if (args && args.length > 0) {\n      method.apply(target, args);\n    } else {\n      method.call(target);\n    }\n  }\n\n  private invokeWithOnError(target, method, args, onError, errorRecordedForStack) {\n    try {\n      if (args && args.length > 0) {\n        method.apply(target, args);\n      } else {\n        method.call(target);\n      }\n    } catch (error) {\n      onError(error, errorRecordedForStack);\n    }\n  }\n}\n","import Queue, { QUEUE_STATE } from './queue';\nimport {\n  each,\n  noSuchMethod,\n  noSuchQueue\n} from './utils';\n\nexport default class DeferredActionQueues {\n  public queues: {\n    [name: string]: Queue\n  };\n\n  private queueNames: string[];\n\n  private options: any;\n\n  private queueNameIndex = 0;\n  constructor(queueNames: string[], options: any) {\n    let queues = this.queues = {};\n    this.queueNames = queueNames = queueNames || [];\n\n    this.options = options;\n\n    each(queueNames, function(queueName) {\n      queues[queueName] = new Queue(queueName, options[queueName], options);\n    });\n  }\n\n  /*\n    @method schedule\n    @param {String} queueName\n    @param {Any} target\n    @param {Any} method\n    @param {Any} args\n    @param {Boolean} onceFlag\n    @param {Any} stack\n    @return queue\n  */\n  public schedule(queueName: string, target: any, method: any, args: any, onceFlag: boolean, stack: any) {\n    let queues = this.queues;\n    let queue = queues[queueName];\n\n    if (!queue) {\n      noSuchQueue(queueName);\n    }\n\n    if (!method) {\n      noSuchMethod(queueName);\n    }\n\n    if (onceFlag) {\n      return queue.pushUnique(target, method, args, stack);\n    } else {\n      return queue.push(target, method, args, stack);\n    }\n  }\n\n  /*\n    @method flush\n    DeferredActionQueues.flush() calls Queue.flush()\n  */\n  public flush() {\n    let queue;\n    let queueName;\n    let numberOfQueues = this.queueNames.length;\n\n    while (this.queueNameIndex < numberOfQueues) {\n      queueName = this.queueNames[this.queueNameIndex];\n      queue = this.queues[queueName];\n\n      if (queue.hasWork() === false) {\n        this.queueNameIndex++;\n      } else {\n        if (queue.flush(false /* async */) === QUEUE_STATE.Pause) {\n          return QUEUE_STATE.Pause;\n        }\n        this.queueNameIndex = 0; // only reset to first queue if non-pause break\n      }\n    }\n  }\n}\n","// accepts a function that when invoked will return an iterator\n// iterator will drain until completion\nexport default function(fn: () => { next: () => { done: Boolean, value?: any}}) {\n  let iterator = fn();\n  let result = iterator.next();\n\n  while (result.done === false) {\n    result.value();\n    result = iterator.next();\n  }\n}\n","import {\n  each,\n  findDebouncee,\n  findItem,\n  findThrottler,\n  getOnError,\n  isCoercableNumber,\n  isFunction,\n  isNumber,\n  isString,\n  now\n} from './backburner/utils';\n\nimport searchTimer from './backburner/binary-search';\nimport DeferredActionQueues from './backburner/deferred-action-queues';\nimport iteratorDrain from './backburner/iterator-drain';\n\nimport Queue, { QUEUE_STATE } from './backburner/queue';\n\nexport default class Backburner {\n  public static Queue = Queue;\n\n  public DEBUG = false;\n\n  public currentInstance: DeferredActionQueues | null | undefined;\n\n  public options: any;\n\n  private queueNames: string[];\n  private instanceStack: DeferredActionQueues[];\n  private _debouncees: any[];\n  private _throttlers: any[];\n  private _eventCallbacks: {\n    end: Function[];\n    begin: Function[];\n  };\n\n  private _boundClearItems: (item) => void;\n  private _timerTimeoutId: number | undefined;\n  private _timers: any[];\n  private _platform: {\n    setTimeout(fn: () => void, ms: number): number;\n    clearTimeout(id: number): void;\n    next(fn: () => void): number;\n    clearNext(fn): void;\n  };\n\n  private _boundRunExpiredTimers: () => void;\n\n  private _autorun: number | null = null;\n  private _boundAutorunEnd: () => void;\n\n  constructor(queueNames: string[], options?: any) {\n    this.queueNames = queueNames;\n    this.options = options || {};\n    if (!this.options.defaultQueue) {\n      this.options.defaultQueue = queueNames[0];\n    }\n    this.currentInstance = null;\n    this.instanceStack = [];\n    this._debouncees = [];\n    this._throttlers = [];\n    this._eventCallbacks = {\n      end: [],\n      begin: []\n    };\n\n    this._boundClearItems = (item) => {\n      this._platform.clearTimeout(item[2]);\n    };\n\n    this._timerTimeoutId = undefined;\n    this._timers = [];\n\n    this._platform = this.options._platform || {\n      setTimeout(fn, ms) {\n        return setTimeout(fn, ms);\n      },\n      clearTimeout(id) {\n        clearTimeout(id);\n      },\n      next(fn) {\n        // TODO: asap\n        return setTimeout(fn, 0);\n      },\n      clearNext(fn) {\n        clearTimeout(fn);\n      }\n    };\n\n    this._boundRunExpiredTimers = () => {\n      this._runExpiredTimers();\n    };\n\n    this._boundAutorunEnd = () => {\n      this._autorun = null;\n      this.end();\n    };\n  }\n\n  /*\n    @method begin\n    @return instantiated class DeferredActionQueues\n  */\n  public begin(): DeferredActionQueues {\n    let options = this.options;\n    let onBegin = options && options.onBegin;\n    let previousInstance = this.currentInstance;\n    let current;\n\n    if (this._autorun) {\n      current = previousInstance;\n      this._cancelAutorun();\n    } else {\n      if (previousInstance) {\n        this.instanceStack.push(previousInstance);\n      }\n      current = this.currentInstance = new DeferredActionQueues(this.queueNames, options);\n      this._trigger('begin', current, previousInstance);\n    }\n\n    if (onBegin) {\n      onBegin(current, previousInstance);\n    }\n\n    return current;\n  }\n\n  public end() {\n    let options = this.options;\n    let onEnd = options && options.onEnd;\n    let currentInstance = this.currentInstance;\n    let nextInstance: DeferredActionQueues | null | undefined = null;\n\n    if (!currentInstance) {\n      throw new Error(`end called without begin`);\n    }\n\n    // Prevent double-finally bug in Safari 6.0.2 and iOS 6\n    // This bug appears to be resolved in Safari 6.0.5 and iOS 7\n    let finallyAlreadyCalled = false;\n    let result;\n    try {\n      result = currentInstance.flush();\n    } finally {\n      if (!finallyAlreadyCalled) {\n        finallyAlreadyCalled = true;\n\n        if (result === QUEUE_STATE.Pause) {\n          const next = this._platform.next;\n          this._autorun = next(this._boundAutorunEnd);\n        } else {\n          this.currentInstance = null;\n\n          if (this.instanceStack.length) {\n            nextInstance = this.instanceStack.pop();\n            this.currentInstance = nextInstance;\n          }\n          this._trigger('end', currentInstance, nextInstance);\n          if (onEnd) {\n            onEnd(currentInstance, nextInstance);\n          }\n        }\n      }\n    }\n  }\n\n  public on(eventName, callback) {\n    if (typeof callback !== 'function') {\n      throw new TypeError(`Callback must be a function`);\n    }\n    let callbacks = this._eventCallbacks[eventName];\n    if (callbacks) {\n      callbacks.push(callback);\n    } else {\n      throw new TypeError(`Cannot on() event ${eventName} because it does not exist`);\n    }\n  }\n\n  public off(eventName, callback) {\n    if (eventName) {\n      let callbacks = this._eventCallbacks[eventName];\n      let callbackFound = false;\n      if (!callbacks) {\n        return;\n      }\n      if (callback) {\n        for (let i = 0; i < callbacks.length; i++) {\n          if (callbacks[i] === callback) {\n            callbackFound = true;\n            callbacks.splice(i, 1);\n            i--;\n          }\n        }\n      }\n      if (!callbackFound) {\n        throw new TypeError(`Cannot off() callback that does not exist`);\n      }\n    } else {\n      throw new TypeError(`Cannot off() event ${eventName} because it does not exist`);\n    }\n  }\n\n  public run(method: Function);\n  public run(target: Function | any | null, method?: Function | string, ...args);\n  public run(target: any | null | undefined, method?: any, ...args: any[]) {\n    let length = arguments.length;\n    let _method: Function | string;\n    let _target: any | null | undefined;\n\n    if (length === 1) {\n      _method = target;\n      _target = null;\n    } else {\n      _method = method;\n      _target = target;\n    }\n\n    if (isString(_method)) {\n      _method = <Function> _target[_method];\n    }\n\n    let onError = getOnError(this.options);\n\n    this.begin();\n\n    if (onError) {\n      try {\n        return _method.apply(_target, args);\n      } catch (error) {\n        onError(error);\n      } finally {\n        this.end();\n      }\n    } else {\n      try {\n        return _method.apply(_target, args);\n      } finally {\n        this.end();\n      }\n    }\n  }\n\n  /*\n    Join the passed method with an existing queue and execute immediately,\n    if there isn't one use `Backburner#run`.\n\n    The join method is like the run method except that it will schedule into\n    an existing queue if one already exists. In either case, the join method will\n    immediately execute the passed in function and return its result.\n\n    @method join\n    @param {Object} target\n    @param {Function} method The method to be executed\n    @param {any} args The method arguments\n    @return method result\n  */\n  public join(...args);\n  public join() {\n    if (!this.currentInstance) {\n      return this.run.apply(this, arguments);\n    }\n\n    let length = arguments.length;\n    let method;\n    let target;\n\n    if (length === 1) {\n      method = arguments[0];\n      target = null;\n    } else {\n      target = arguments[0];\n      method = arguments[1];\n    }\n\n    if (isString(method)) {\n      method = target[method];\n    }\n\n    if (length === 1) {\n      return method();\n    } else if (length === 2) {\n      return method.call(target);\n    } else {\n      let args = new Array(length - 2);\n      for (let i = 0, l = length - 2; i < l; i++) {\n        args[i] = arguments[i + 2];\n      }\n      return method.apply(target, args);\n    }\n  }\n\n  /**\n   * @deprecated please use schedule instead.\n   */\n  public defer(queueName: string, ...args);\n  public defer() {\n    return this.schedule.apply(this, arguments);\n  }\n\n  /**\n   * Schedule the passed function to run inside the specified queue.\n   */\n  public schedule(queueName: string, method: Function);\n  public schedule<T, U extends keyof T>(queueName: string, target: T, method: U, ...args);\n  public schedule(queueName: string, target: any | null, method: any | Function, ...args);\n  public schedule(queueName: string) {\n    let length = arguments.length;\n    let method;\n    let target;\n    let args;\n\n    if (length === 2) {\n      method = arguments[1];\n      target = null;\n    } else {\n      target = arguments[1];\n      method = arguments[2];\n    }\n\n    if (isString(method)) {\n      method = target[method];\n    }\n\n    let stack = this.DEBUG ? new Error() : undefined;\n\n    if (length > 3) {\n      args = new Array(length - 3);\n      for (let i = 3; i < length; i++) {\n        args[i - 3] = arguments[i];\n      }\n    } else {\n      args = undefined;\n    }\n    return this._ensureInstance().schedule(queueName, target, method, args, false, stack);\n  }\n\n  /*\n    Defer the passed iterable of functions to run inside the specified queue.\n\n    @method scheduleIterable\n    @param {String} queueName\n    @param {Iterable} an iterable of functions to execute\n    @return method result\n  */\n  public scheduleIterable(queueName: string, iterable: Function) {\n    let stack = this.DEBUG ? new Error() : undefined;\n    let _iteratorDrain = iteratorDrain;\n    return this._ensureInstance().schedule(queueName, null, _iteratorDrain, [iterable], false, stack);\n  }\n\n  /**\n   * @deprecated please use scheduleOnce instead.\n   */\n  public deferOnce(queueName: string, ...args);\n  public deferOnce() {\n    return this.scheduleOnce.apply(this, arguments);\n  }\n\n  /**\n   * Schedule the passed function to run once inside the specified queue.\n   */\n  public scheduleOnce(queueName: string, method: Function);\n  public scheduleOnce<T, U extends keyof T>(queueName: string, target: T, method: U, ...args);\n  public scheduleOnce(queueName: string, target: any | null, method: any | Function, ...args);\n  public scheduleOnce(queueName: string /* , target, method, args */) {\n    let length = arguments.length;\n    let method;\n    let target;\n    let args;\n\n    if (length === 2) {\n      method = arguments[1];\n      target = null;\n    } else {\n      target = arguments[1];\n      method = arguments[2];\n    }\n\n    if (isString(method)) {\n      method = target[method];\n    }\n\n    let stack = this.DEBUG ? new Error() : undefined;\n\n    if (length > 3) {\n      args = new Array(length - 3);\n      for (let i = 3; i < length; i++) {\n        args[i - 3] = arguments[i];\n      }\n    } else {\n      args = undefined;\n    }\n\n    let currentInstance = this._ensureInstance();\n    return currentInstance.schedule(queueName, target, method, args, true, stack);\n  }\n\n  /**\n   * @deprecated use later instead.\n   */\n  public setTimeout(...args);\n  public setTimeout() {\n    return this.later.apply(this, arguments);\n  }\n\n  public later(...args);\n  public later() {\n    let l = arguments.length;\n    let args = new Array(l);\n\n    for (let x = 0; x < l; x++) {\n      args[x] = arguments[x];\n    }\n\n    let length = args.length;\n    let method;\n    let wait;\n    let target;\n    let methodOrTarget;\n    let methodOrWait;\n    let methodOrArgs;\n\n    if (length === 0) {\n      return;\n    } else if (length === 1) {\n      method = args.shift();\n      wait = 0;\n    } else if (length === 2) {\n      methodOrTarget = args[0];\n      methodOrWait = args[1];\n\n      if (isFunction(methodOrWait) || isFunction(methodOrTarget[methodOrWait])) {\n        target = args.shift();\n        method = args.shift();\n        wait = 0;\n      } else if (isCoercableNumber(methodOrWait)) {\n        method = args.shift();\n        wait = args.shift();\n      } else {\n        method = args.shift();\n        wait =  0;\n      }\n    } else {\n      let last = args[args.length - 1];\n\n      if (isCoercableNumber(last)) {\n        wait = args.pop();\n      } else {\n        wait = 0;\n      }\n\n      methodOrTarget = args[0];\n      methodOrArgs = args[1];\n\n      if (isFunction(methodOrArgs) || (isString(methodOrArgs) &&\n                                      methodOrTarget !== null &&\n                                      methodOrArgs in methodOrTarget)) {\n        target = args.shift();\n        method = args.shift();\n      } else {\n        method = args.shift();\n      }\n    }\n\n    let executeAt = now() + parseInt(wait !== wait ? 0 : wait, 10);\n\n    if (isString(method)) {\n      method = target[method];\n    }\n\n    let onError = getOnError(this.options);\n\n    function fn() {\n      if (onError) {\n        try {\n          method.apply(target, args);\n        } catch (e) {\n          onError(e);\n        }\n      } else {\n        method.apply(target, args);\n      }\n    }\n\n    return this._setTimeout(fn, executeAt);\n  }\n\n  public throttle(...args);\n  public throttle(target, method /* , args, wait, [immediate] */) {\n    let backburner = this;\n    let args = new Array(arguments.length);\n    for (let i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n    let immediate = args.pop();\n    let wait;\n    let throttler;\n    let index;\n    let timer;\n\n    if (isNumber(immediate) || isString(immediate)) {\n      wait = immediate;\n      immediate = true;\n    } else {\n      wait = args.pop();\n    }\n\n    wait = parseInt(wait, 10);\n\n    index = findThrottler(target, method, this._throttlers);\n    if (index > -1) { return this._throttlers[index]; } // throttled\n\n    timer = this._platform.setTimeout(function() {\n      if (!immediate) {\n        backburner.run.apply(backburner, args);\n      }\n      index = findThrottler(target, method, backburner._throttlers);\n      if (index > -1) {\n        backburner._throttlers.splice(index, 1);\n      }\n    }, wait);\n\n    if (immediate) {\n      this.join.apply(this, args);\n    }\n\n    throttler = [target, method, timer];\n\n    this._throttlers.push(throttler);\n\n    return throttler;\n  }\n\n  public debounce(...args);\n  public debounce(target, method /* , args, wait, [immediate] */) {\n    let backburner = this;\n    let args = new Array(arguments.length);\n    for (let i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    let immediate = args.pop();\n    let wait;\n    let index;\n    let debouncee;\n    let timer;\n\n    if (isNumber(immediate) || isString(immediate)) {\n      wait = immediate;\n      immediate = false;\n    } else {\n      wait = args.pop();\n    }\n\n    wait = parseInt(wait, 10);\n    // Remove debouncee\n    index = findDebouncee(target, method, this._debouncees);\n\n    if (index > -1) {\n      debouncee = this._debouncees[index];\n      this._debouncees.splice(index, 1);\n      this._platform.clearTimeout(debouncee[2]);\n    }\n\n    timer = this._platform.setTimeout(function() {\n      if (!immediate) {\n        backburner.run.apply(backburner, args);\n      }\n      index = findDebouncee(target, method, backburner._debouncees);\n      if (index > -1) {\n        backburner._debouncees.splice(index, 1);\n      }\n    }, wait);\n\n    if (immediate && index === -1) {\n      backburner.run.apply(backburner, args);\n    }\n\n    debouncee = [\n      target,\n      method,\n      timer\n    ];\n\n    backburner._debouncees.push(debouncee);\n\n    return debouncee;\n  }\n\n  public cancelTimers() {\n    each(this._throttlers, this._boundClearItems);\n    this._throttlers = [];\n\n    each(this._debouncees, this._boundClearItems);\n    this._debouncees = [];\n\n    this._clearTimerTimeout();\n    this._timers = [];\n\n    if (this._autorun) {\n      this._platform.clearNext(this._autorun);\n      this._autorun = null;\n    }\n\n    this._cancelAutorun();\n  }\n\n  public hasTimers() {\n    return !!this._timers.length || !!this._debouncees.length || !!this._throttlers.length || this._autorun;\n  }\n\n  public cancel(timer?) {\n    let timerType = typeof timer;\n\n    if (timer && timerType === 'object' && timer.queue && timer.method) { // we're cancelling a deferOnce\n      return timer.queue.cancel(timer);\n    } else if (timerType === 'function') { // we're cancelling a setTimeout\n      for (let i = 0, l = this._timers.length; i < l; i += 2) {\n        if (this._timers[i + 1] === timer) {\n          this._timers.splice(i, 2); // remove the two elements\n          if (i === 0) {\n            this._reinstallTimerTimeout();\n          }\n          return true;\n        }\n      }\n    } else if (Object.prototype.toString.call(timer) === '[object Array]') { // we're cancelling a throttle or debounce\n      return this._cancelItem(findThrottler, this._throttlers, timer) ||\n               this._cancelItem(findDebouncee, this._debouncees, timer);\n    } else {\n      return; // timer was null or not a timer\n    }\n  }\n\n  private _cancelAutorun() {\n    if (this._autorun) {\n      this._platform.clearTimeout(this._autorun);\n      this._autorun = null;\n    }\n  }\n\n  private _setTimeout(fn, executeAt) {\n    if (this._timers.length === 0) {\n      this._timers.push(executeAt, fn);\n      this._installTimerTimeout();\n      return fn;\n    }\n\n    // find position to insert\n    let i = searchTimer(executeAt, this._timers);\n\n    this._timers.splice(i, 0, executeAt, fn);\n\n    // we should be the new earliest timer if i == 0\n    if (i === 0) {\n      this._reinstallTimerTimeout();\n    }\n\n    return fn;\n  }\n\n  private _cancelItem(findMethod, array, timer) {\n    let item;\n    let index;\n\n    if (timer.length < 3) { return false; }\n\n    index = findMethod(timer[0], timer[1], array);\n\n    if (index > -1) {\n\n      item = array[index];\n\n      if (item[2] === timer[2]) {\n        array.splice(index, 1);\n        this._platform.clearTimeout(timer[2]);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   Trigger an event. Supports up to two arguments. Designed around\n   triggering transition events from one run loop instance to the\n   next, which requires an argument for the first instance and then\n   an argument for the next instance.\n\n   @private\n   @method _trigger\n   @param {String} eventName\n   @param {any} arg1\n   @param {any} arg2\n   */\n  private _trigger<T, U>(eventName: string, arg1: T, arg2: U) {\n    let callbacks = this._eventCallbacks[eventName];\n    if (callbacks) {\n      for (let i = 0; i < callbacks.length; i++) {\n        callbacks[i](arg1, arg2);\n      }\n    }\n  }\n\n  private _runExpiredTimers() {\n    this._timerTimeoutId = undefined;\n    this.run(this, this._scheduleExpiredTimers);\n  }\n\n  private _scheduleExpiredTimers() {\n    let n = now();\n    let timers = this._timers;\n    let i = 0;\n    let l = timers.length;\n    for (; i < l; i += 2) {\n      let executeAt = timers[i];\n      let fn = timers[i + 1];\n      if (executeAt <= n) {\n        this.schedule(this.options.defaultQueue, null, fn);\n      } else {\n        break;\n      }\n    }\n    timers.splice(0, i);\n    this._installTimerTimeout();\n  }\n\n  private _reinstallTimerTimeout() {\n    this._clearTimerTimeout();\n    this._installTimerTimeout();\n  }\n\n  private _clearTimerTimeout() {\n    if (!this._timerTimeoutId) {\n      return;\n    }\n    this._platform.clearTimeout(this._timerTimeoutId);\n    this._timerTimeoutId = undefined;\n  }\n\n  private _installTimerTimeout() {\n    if (!this._timers.length) {\n      return;\n    }\n    let minExpiresAt = this._timers[0];\n    let n = now();\n    let wait = Math.max(0, minExpiresAt - n);\n    this._timerTimeoutId = this._platform.setTimeout(this._boundRunExpiredTimers, wait);\n  }\n\n  private _ensureInstance(): DeferredActionQueues {\n    let currentInstance = this.currentInstance;\n    if (!currentInstance) {\n      const next = this._platform.next || this._platform.setTimeout; // TODO: remove the fallback\n      currentInstance = this.begin();\n      this._autorun = next(this._boundAutorunEnd);\n    }\n    return currentInstance;\n  }\n}\n"],"names":["searchTimer"],"mappings":"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"}